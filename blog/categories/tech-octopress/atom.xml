<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Tech-octopress | 丘海东]]></title>
  <link href="https://qiuhaidong.github.io/blog/categories/tech-octopress/atom.xml" rel="self"/>
  <link href="https://qiuhaidong.github.io/"/>
  <updated>2022-03-19T20:32:44+08:00</updated>
  <id>https://qiuhaidong.github.io/</id>
  <author>
    <name><![CDATA[丘海东]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Back to Top返回頂部按鈕]]></title>
    <link href="https://qiuhaidong.github.io/blog/2022/02/27/back-to-top/"/>
    <updated>2022-02-27T18:52:33+08:00</updated>
    <id>https://qiuhaidong.github.io/blog/2022/02/27/back-to-top</id>
    <content type="html"><![CDATA[<p><a href="https://www.jianshu.com/p/fe0e089a985c">教程1</a><br/>
<a href="https://www.cnblogs.com/biglucky/p/4148867.html">教程2</a></p>

<h3>实现返回按钮功能</h3>

<p>首先创建<code>source/javascripts/top.js</code>，添加如下代码实现滑动返回顶部效果:</p>

<pre><code class="javascript">function goTop(acceleration, time)
{
        acceleration = acceleration || 1;  //加速度
        time = time || 16;  //时间间隔 (毫秒)

        var x1 = 0;
        var y1 = 0;
        var x2 = 0;
        var y2 = 0;
        var x3 = 0;
        var y3 = 0;

        if (document.documentElement)
        {
                x1 = document.documentElement.scrollLeft || 0;
                y1 = document.documentElement.scrollTop || 0;
        }
        if (document.body)
        {
                x2 = document.body.scrollLeft || 0;
                y2 = document.body.scrollTop || 0;
        }
        var x3 = window.scrollX || 0;
        var y3 = window.scrollY || 0;

        // 滚动条到页面顶部的水平距离
        var x = Math.max(x1, Math.max(x2, x3));
        // 滚动条到页面顶部的垂直距离
        var y = Math.max(y1, Math.max(y2, y3));

        // 滚动距离 = 目前距离 / 速度, 因为距离原来越小, 速度是大于 1 的数, 所以滚动距离会越来越小
        var speed = 1 + acceleration;
        window.scrollTo(Math.floor(x / speed), Math.floor(y / speed));

        // 如果距离不为零, 继续调用迭代本函数
        if(x &gt; 0 || y &gt; 0)
        {
                var invokeFunction = "goTop(" + acceleration + ", " + time + ")";
                window.setTimeout(invokeFunction, time);
        }
}
</code></pre>

<h3>自定义返回按钮格式</h3>

<p>创建<code>source/_includes/custom/totop.html</code>，设置返回顶部按钮样式和位置<br/>
其中的<code>width、height、right、bottom</code>为图片在网页中的位置，可根据图片大小自行设定，示例代码如下：</p>

<p>``` html</p>

<!--返回顶部开始-->


<div id="full" style="width:30px; height:30px; position:fixed; right:13px; bottom:13px; z-index:100; text-align:center; background-color:transparent; cursor:pointer;">
<a href="#" onclick="goTop();return false;"><img src="https://qiuhaidong.github.io/images/top.png" border=0 alt="返回顶部"></a>
</div>


<script src="https://qiuhaidong.github.io/javascripts/top.js" type="text/javascript"></script>


<!--返回顶部结束-->


<pre><code>
### 选择按钮图片
找到自己喜爱的返回按钮图片，命名为`top.png`后添加到`source/images`目录中（或修改`totop.html`中图片的路径），文件名和`totop.html`中的一致就可以了，可以自己命名。  

然后把`totop.html` 引入到文件中，考虑到进到具体每一篇blog里面也有这个功能，我们把这个文件在`foot.html`中引入，修改:`octopress/source/_includes/custom/footer.html`，添加一行：  
![octopress/source/_includes/custom/footer.html](http://r.photo.store.qq.com/psc?/V53xBhKC4JFvE03uTNAL1QWxNF3K6JJT/TmEUgtj9EK6.7V8ajmQrEMHNMi9RBV8SPCiQjrpiIVqTO0oBBa1zGSTDwX1cxXY1I0xQDhEyJNc9d2jqFOe5QAet0C9GvAgWzpRjxvDQ7Sc!/r)  
</code></pre>

<p>  {\% include custom/totop.html \%}  //记得去除两个\号
```</p>

<p>bug提醒：如果post文件中有上面这一行代码（没有\号），blog网站首页和这篇博文页，会有返回按钮图片错误</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[添加tags，導航欄，側邊欄]]></title>
    <link href="https://qiuhaidong.github.io/blog/2022/02/27/add-tags/"/>
    <updated>2022-02-27T16:34:34+08:00</updated>
    <id>https://qiuhaidong.github.io/blog/2022/02/27/add-tags</id>
    <content type="html"><![CDATA[<p><a href="http://www.aobosir.com/blog/2016/10/12/octopress-build-static-blog-site-add-tag-cloud-to-site-sidebar/">参考1</a></p>

<h3>下载</h3>

<p>首先到 <a href="https://github.com/robbyedwards/octopress-tag-pages">https://github.com/robbyedwards/octopress-tag-pages</a> 和 <a href="https://github.com/robbyedwards/octopress-tag-cloud">https://github.com/robbyedwards/octopress-tag-cloud</a> 下载这两个项目的代码。</p>

<h3>octopress-tag-pages</h3>

<p>把里面的文件复制到相应位置，之前已有的文件，看代码，把需要的代码加上去，<code>.md</code>文件先不用管</p>

<h3>octopress-tag-cloud</h3>

<p><strong>1 .</strong> 将 <code>octopress-tag-cloud\plugins</code>  路径里面的 <code>tag_cloud.rb</code>  文件复制到 <code>octopress\plugins\</code>  文件夹里面。</p>

<p><strong>2 .</strong> 将下面的代码复制到 <code>octopress\source\_includes\custom\asides\tags.html</code>。（这个文件需要自己新建。）
<strong>注意：</strong> 去掉 <code>%</code> 前面的反斜杠<code>\</code>。</p>

<pre><code class="html">&lt;section&gt;
  &lt;h1&gt;Tags&lt;/h1&gt;
  &lt;ul id="tag-cloud"&gt;
    {\% tag_cloud font-size: 120-160%, limit: 20 \%}
  &lt;/ul&gt;
&lt;/section&gt;
</code></pre>

<p>解释：</p>

<p><code>tag_cloud</code> 的参数中， <code>font-size</code> 指定 <code>tag</code> 的大小范围；<code>limit</code> 限定 <code>20</code> 个 <code>tag</code> 。</p>

<p><strong>3 .</strong> 在 <code>octopress\_config.yml</code> 中的 <code>default_asides</code> 中添加 <code>custom/asides/tags.html</code>，注意相应的位置。
<code>
default_asides: [custom/asides/tags.html, .....]
</code></p>

<p>博文写标签：</p>

<pre><code>tags: [tag1, tag2, tag3]
</code></pre>

<p> <code>rake generate</code> 出现问题：</p>

<p><img src="http://r.photo.store.qq.com/psc?/V53xBhKC4JFvE03uTNAL1QWxNF3K6JJT/TmEUgtj9EK6.7V8ajmQrEBdI0C.SIjWT7xp6kxk44HtNtPC263DeEkNHJxhmSxZADk0hrbMx8wpKHzK5e5i3chf0lcEBpbc6HvuMur2Yj2M!/r" alt="Alt text" /></p>

<pre><code>  Liquid Exception: comparison of Array with Array failed in _layouts/page.html
</code></pre>

<h3>解决</h3>

<p><code>octopress\plugins\tag_cloud.rb</code> 第74行:</p>

<pre><code class="ruby">if @limit &gt; 0 and @sort != 'rand'
    # sort the tag pairs by frequency in descending order
    weighted.sort! { |a,b| b[1] &lt;=&gt; a[1] }
    # then slice off the top @limit tag pairs
    weighted = weighted[0,@limit]
end
</code></pre>

<p><code>weighted = weighted[0,@limit]</code> 应该是取指定数目的标签。如果标签数量少于 <code>@limit</code> ，会报错。</p>

<p>修改第74行为:</p>

<pre><code class="ruby">      if @limit &gt; 0 and @sort != 'rand' and @limit &lt; weighted.length
</code></pre>

<p>修改第95行为:</p>

<pre><code class="ruby">        if @limit &gt; 0 and @limit &lt; weighted.length
</code></pre>

<p><code>rake generate</code> ，不再出现错误</p>

<p>出现另一警告：</p>

<p><img src="http://r.photo.store.qq.com/psc?/V53xBhKC4JFvE03uTNAL1QWxNF3K6JJT/TmEUgtj9EK6.7V8ajmQrEEVv9L5qdjCrWDNsdaae1gecrl4Dk5DfGovwzPBz4NGxy2YEcsjFTGZk9HPnZ4pdOW3MLz5JmXZtaeKeBaKa9YY!/r" alt="Alt text" /></p>

<p><code>rake preview</code> ，标签云成功添加:</p>

<p><img src="http://r.photo.store.qq.com/psc?/V53xBhKC4JFvE03uTNAL1QWxNF3K6JJT/TmEUgtj9EK6.7V8ajmQrEMkifW2gJW9D*DOdH8mhfQXdNtXOdqE9gQNJ5cLGRw3mEOzZJ.eR*6x07lmQqrmSHEFlbcBrFrU*4FcTQePqHV0!/r" alt="Alt text" /></p>

<h3>解决 <code>Build Warning: Layout 'nil' requested in tags/标签名/atom.xml does not exist.</code> 警告问题</h3>

<p>将 <code>octopress\source\_includes\custom\tag_feed.xml</code> 文件里面 <code>nil</code> 改为 <code>null</code> ：</p>

<pre><code>---
layout: null
---
</code></pre>

<h2>搞定</h2>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[加速Octopress2.0，太慢了]]></title>
    <link href="https://qiuhaidong.github.io/blog/2022/02/27/speed-up-octopress2-dot-0/"/>
    <updated>2022-02-27T00:54:38+08:00</updated>
    <id>https://qiuhaidong.github.io/blog/2022/02/27/speed-up-octopress2-dot-0</id>
    <content type="html"><![CDATA[<h2><a href="https://droidyue.com/blog/2014/06/22/fix-octopress-slow-loading-speed-issue-in-china-mainland/">原博</a></h2>

<h2>清理没用的服务</h2>

<p>以下修改均修改<code>_config.yml</code>,以下可以根据自己的需要进行去除。</p>

<p><strong>去除Disqus评论</strong><br/>
打开文件找到<code>Disqus Comments</code>，按照下面在每一行前面加#注释掉即可</p>

<pre><code># Disqus Comments
#disqus_short_name: 
#disqus_show_comment_count: true
</code></pre>

<p><strong>去掉Github仓库展示</strong></p>

<pre><code># Github repositories
#github_user: 
#github_repo_count: 
#github_show_profile_link: true
#github_skip_forks: true
</code></pre>

<p><strong>去除Twitter按钮</strong><br/>
<strong>去除Google+相关</strong><br/>
<strong>去除Pinboard服务</strong><br/>
<strong>去除Delicious评论，去除后可能没有评论系统</strong><br/>
<strong>去除Facebook Like</strong></p>

<h2>替换快速的请求资源</h2>

<p>其实，真正解决加速的重要环节可能是这里，因为Octopress很多依赖于Google的库和资源。</p>

<h3>解决Google Analytics巨慢的问题</h3>

<p>对于使用Google Analytics来说，加在ga.js这个文件简直是要命的慢，这里我使用自己存放在七牛CDN上的js.  <a href="http://droidyue-tools.qiniudn.com/ga.js">http://droidyue-tools.qiniudn.com/ga.js</a> 已验证，完全可以正常收集数据。<br/>
参考如下，修改<code>source/_includes/google_analytics.html</code></p>

<pre><code class="html"> _gaq.push(['_trackPageview']);

 (function() {
 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
 ga.src='http://droidyue-tools.qiniudn.com/ga.js';
 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
 })();
   &lt;/script&gt;
</code></pre>

<h3>解决fonts.googleapis.com蜗牛慢</h3>

<p>这里我们使用数字公司提供的Google Fonts大陆解决方案，使用<code>fonts.useso.com</code>替换<code>fonts.googleapis.com</code>。<br/>
修改文件<code>/source/_includes/custom/head.html</code></p>

<pre><code class="html"> &lt;!--Fonts from Google"s Web font directory at http://google.com/webfonts --&gt;
&lt;link href="http://fonts.useso.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"&gt;
&lt;link href="http://fonts.useso.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"&gt;
</code></pre>

<h3>解决ajax.googleapis.com慢的问题</h3>

<p>修改<code>source/_includes/head.html</code></p>

<p>``` html</p>

<script src="//ajax.useso.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>


<script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>


<script src="https://qiuhaidong.github.io/javascripts/octopress.js" type="text/javascript"></script>


<p>```</p>

<h3>總結</h3>

<p>导致网站慢的原因其实是加载Google的资源，当然我们不能怨Google.经过测试，使用数字公司的解决方法之后，国内国外访问速度都是可以的。这里还是推荐以下数字公司的这个解决方案<a href="http://libs.useso.com/">http://libs.useso.com/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ubuntu20.04 octopress2.0]]></title>
    <link href="https://qiuhaidong.github.io/blog/2022/02/26/ubuntu20-dot-04-octopress2-dot-0/"/>
    <updated>2022-02-26T18:31:18+08:00</updated>
    <id>https://qiuhaidong.github.io/blog/2022/02/26/ubuntu20-dot-04-octopress2-dot-0</id>
    <content type="html"><![CDATA[<p>有時候報錯，記得把<code>Gemfile.lock</code>文件刪除<br/>
Ubuntu20.04自帶3版本的python，不兼容Octopress2.0的依賴。故安裝2版本<br/>
<code>
rvm use 2.2.6
sudo apt install python2
</code>
test:</p>

<h3>010203040506070809 69</h3>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octopress3.0訪問速度比2.0快太多了]]></title>
    <link href="https://qiuhaidong.github.io/blog/2022/02/24/octopress-3-0-is-faster-than-2-0/"/>
    <updated>2022-02-24T16:53:49+08:00</updated>
    <id>https://qiuhaidong.github.io/blog/2022/02/24/octopress-3-0-is-faster-than-2-0</id>
    <content type="html"><![CDATA[<p>真是快太多了，完全不是一個級別的，2.0有時候根本就訪問不了<br/>
<a href="https://qiuhaidong.github.io/blog/2022/02/27/speed-up-octopress2-dot-0/">加速Octopress2.0</a></p>
]]></content>
  </entry>
  
</feed>
